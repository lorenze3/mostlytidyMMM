<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Get started â€¢ mostlytidyMMM</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Get started">
<meta property="og:description" content="mostlytidyMMM">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mostlytidyMMM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/get-started.html">Get started</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Get started</h1>
            
      
      
      <div class="hidden name"><code>get-started.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mostlytidyMMM</span><span class="op">)</span></span></code></pre></div>
<!-- WARNING - This vignette is generated by {fusen} from dev/flat_full.Rmd: do not edit by hand -->
<!-- Run this 'development' chunk -->
<!-- Store every call to library() that you need to explore your functions -->
<!--
 You need to run the 'description' chunk in the '0-dev_history.Rmd' file before continuing your code there.

If it is the first time you use {fusen}, after 'description', you can directly run the last chunk of the present file with inflate() inside.
-->
<div class="section level2">
<h2 id="include-some-data-examples-in-your-package">Include some data examples in your package<a class="anchor" aria-label="anchor" href="#include-some-data-examples-in-your-package"></a>
</h2>
<!-- 
 Store your dataset in a directory named "inst/" at the root of your project.
 Use it for your tests in this Rmd thanks to `pkgload::load_all()` to make it available
and `system.file()` to read it in your examples.
-->
</div>
<div class="section level2">
<h2 id="custom-recipe-steps">custom recipe steps<a class="anchor" aria-label="anchor" href="#custom-recipe-steps"></a>
</h2>
<!--
Create a chunk for the core of the function

- The chunk needs to be named `function` at least
- It contains the code of a documented function
- The chunk can also be named `function-my_median` to make it easily
findable in your Rmd
- Let the `@examples` part empty, and use the next `examples` chunk instead

After inflating the template

-  This function code will be added in a new file in the "R/" directory
-->
<!--
Create a chunk with an example of use for your function

- The chunk needs to be named `examples` at least
- It contains working examples of your function
- The chunk is better be named `examples-my_median` to be handled
correctly when inflated as a vignette

After inflating the template

-  This example will be added in the '@examples' part of our function above in the "R/" directory
- This example will be added in the vignette created from this Rmd template
-->
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#not run!</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'tidyverse' was built under R version 4.1.3</span></span>
<span><span class="co">#&gt; -- <span style="font-weight: bold;">Attaching packages</span> --------------------------------------- tidyverse 1.3.2 --</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">v</span> <span style="color: #0000BB;">ggplot2</span> 3.3.6     <span style="color: #00BB00;">v</span> <span style="color: #0000BB;">purrr  </span> 0.3.4</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">v</span> <span style="color: #0000BB;">tibble </span> 3.2.1     <span style="color: #00BB00;">v</span> <span style="color: #0000BB;">dplyr  </span> 1.1.3</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">v</span> <span style="color: #0000BB;">tidyr  </span> 1.2.1     <span style="color: #00BB00;">v</span> <span style="color: #0000BB;">stringr</span> 1.5.0</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">v</span> <span style="color: #0000BB;">readr  </span> 2.1.2     <span style="color: #00BB00;">v</span> <span style="color: #0000BB;">forcats</span> 0.5.1</span></span>
<span><span class="co">#&gt; Warning: package 'ggplot2' was built under R version 4.1.3</span></span>
<span><span class="co">#&gt; Warning: package 'tibble' was built under R version 4.1.3</span></span>
<span><span class="co">#&gt; Warning: package 'tidyr' was built under R version 4.1.3</span></span>
<span><span class="co">#&gt; -- <span style="font-weight: bold;">Conflicts</span> ------------------------------------------ tidyverse_conflicts() --</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">x</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">x</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/recipes" class="external-link">recipes</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'recipes' was built under R version 4.1.3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'recipes'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stringr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     fixed</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     step</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tune.tidymodels.org/" class="external-link">tune</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'tune' was built under R version 4.1.3</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dials.tidymodels.org" class="external-link">dials</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'dials' was built under R version 4.1.3</span></span>
<span><span class="co">#&gt; Loading required package: scales</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'scales'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The following object is masked from 'package:purrr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     discard</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The following object is masked from 'package:readr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     col_factor</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mostlytidyMMM</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#create two datasets</span></span>
<span><span class="va">mktdata</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>prod<span class="op">=</span><span class="st">'brand'</span>,store<span class="op">=</span><span class="st">'store1'</span>,</span>
<span>                      sales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">100</span>,<span class="fl">100</span>,<span class="fl">100</span>,<span class="fl">100</span><span class="op">)</span>,tv<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">100</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span>,</span>
<span>                      search<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">50</span>,<span class="fl">50</span><span class="op">)</span><span class="op">)</span> ,</span>
<span>               <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>prod<span class="op">=</span><span class="st">'brand'</span>,store<span class="op">=</span><span class="st">'store2'</span>,</span>
<span>                      sales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">10</span><span class="op">)</span>,tv<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>                      search<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span> <span class="op">)</span> <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">prod</span>,<span class="va">store</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mktdata2</span><span class="op">&lt;-</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>prod<span class="op">=</span><span class="st">'brand'</span>,store<span class="op">=</span><span class="st">'all'</span>,</span>
<span>                 sales<span class="op">=</span><span class="fl">100</span>,tv<span class="op">=</span><span class="fl">1000</span>,search<span class="op">=</span><span class="fl">1000</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">prod</span>,<span class="va">store</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#creating a recipe with a saturaiton step in it</span></span>
<span><span class="va">rec_obj</span> <span class="op">&lt;-</span></span>
<span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">sales</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">mktdata</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span> <span class="fu"><a href="../reference/step_saturation.html">step_saturation</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tv</span>,<span class="va">search</span><span class="op">)</span>,asymptote<span class="op">=</span><span class="fl">200</span>,saturation_speed<span class="op">=</span><span class="fl">.003</span> <span class="op">)</span> <span class="op">|&gt;</span></span>
<span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html" class="external-link">prep</a></span><span class="op">(</span>training <span class="op">=</span> <span class="va">mktdata</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#showing what a tunable recipe looks liek:</span></span>
<span><span class="va">rec_obj2</span><span class="op">&lt;-</span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">sales</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">mktdata</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/step_saturation.html">step_saturation</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tv</span>,<span class="va">search</span><span class="op">)</span>,asymptote<span class="op">=</span><span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html" class="external-link">tune</a></span><span class="op">(</span><span class="op">)</span>,saturation_speed<span class="op">=</span><span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html" class="external-link">tune</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_parameter_set_dials</a></span><span class="op">(</span><span class="va">rec_obj2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Collection of 2 parameters for tuning</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        identifier             type    object</span></span>
<span><span class="co">#&gt;         asymptote        asymptote nparam[+]</span></span>
<span><span class="co">#&gt;  saturation_speed saturation_speed nparam[+]</span></span>
<span></span>
<span> <span class="co">#custom print shows values of saturation hyperparameters:</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">rec_obj</span><span class="op">)</span></span>
<span><span class="co">#&gt; Recipe</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Inputs:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       role #variables</span></span>
<span><span class="co">#&gt;    outcome          1</span></span>
<span><span class="co">#&gt;  predictor          4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Training data contained 10 data points and no missing data.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Operations:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Saturation (asymptote= 200 saturation_speed= 0.003 Transformation ontv, search [trained]</span></span>
<span> <span class="co">#or shows that they are set to be tuned:</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">rec_obj2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Recipe</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Inputs:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       role #variables</span></span>
<span><span class="co">#&gt;    outcome          1</span></span>
<span><span class="co">#&gt;  predictor          4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Operations:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Saturation (asymptote= tune saturation_speed= tune Transformation onc(tv, search)</span></span>
<span> <span class="co">#producing the transformed dataset:</span></span>
<span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/bake.html" class="external-link">bake</a></span><span class="op">(</span><span class="va">rec_obj</span>,<span class="va">mktdata</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 x 5</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   prod, store [2]</span></span></span>
<span><span class="co">#&gt;    prod  store     tv search sales</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> brand store1  5.91   0      100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> brand store1 51.8    5.91   100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> brand store1  0     11.6    100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> brand store1  0     27.9    100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> brand store1 51.8   27.9    100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> brand store2  0      0       10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> brand store2  0      1.20    10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> brand store2  0      1.20    10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> brand store2  0      0       10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> brand store2  0      0       10</span></span></code></pre></div>
<!--
Create a chunk with a test of use for your function

- The chunk needs to be named `tests` at least
- It contains working tests of your function
- The chunk is better be named `tests-my_median` to be handled
correctly when inflated as a vignette

After inflating the template

-  This test code will be added in the "tests/testthat/" directory
-->
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/recipes" class="external-link">recipes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tune.tidymodels.org/" class="external-link">tune</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dials.tidymodels.org" class="external-link">dials</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mostlytidyMMM</span><span class="op">)</span></span>
<span><span class="co">#create two datasets:</span></span>
<span><span class="va">mktdata</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>prod<span class="op">=</span><span class="st">'brand'</span>,store<span class="op">=</span><span class="st">'store1'</span>,</span>
<span>                      sales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100.</span>,<span class="fl">100.</span>,<span class="fl">100.</span>,<span class="fl">100.</span>,<span class="fl">100.</span><span class="op">)</span>,</span>
<span>                      tv<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10.</span>,<span class="fl">100.</span>,<span class="fl">0.</span>,<span class="fl">0.</span>,<span class="fl">100</span><span class="op">)</span>,</span>
<span>                      search<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">50.</span>,<span class="fl">50.</span><span class="op">)</span><span class="op">)</span> ,</span>
<span>               <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>prod<span class="op">=</span><span class="st">'brand'</span>,store<span class="op">=</span><span class="st">'store2'</span>,</span>
<span>                      sales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10.</span>,<span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">10</span><span class="op">)</span>,tv<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>                      search<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span> <span class="op">)</span> <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">prod</span>,<span class="va">store</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mktdata2</span><span class="op">&lt;-</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>prod<span class="op">=</span><span class="st">'brand'</span>,store<span class="op">=</span><span class="st">'all'</span>,sales<span class="op">=</span><span class="fl">100</span>,tv<span class="op">=</span><span class="fl">1000</span>,search<span class="op">=</span><span class="fl">1000</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">prod</span>,<span class="va">store</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#build a recipe with two different adstock steps -- could be done in one step</span></span>
<span><span class="va">rec_obj</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">sales</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">mktdata</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/step_adstock.html">step_adstock</a></span><span class="op">(</span><span class="va">tv</span>,retention<span class="op">=</span><span class="fl">.5</span>,groups<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'prod'</span>,<span class="st">'store'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/step_adstock.html">step_adstock</a></span><span class="op">(</span><span class="va">search</span>,retention<span class="op">=</span><span class="fl">.5</span>,groups<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'prod'</span>,<span class="st">'store'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html" class="external-link">prep</a></span><span class="op">(</span>training <span class="op">=</span> <span class="va">mktdata</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#showing off the custom print function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">rec_obj</span><span class="op">)</span></span>
<span><span class="co">#&gt; Recipe</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Inputs:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       role #variables</span></span>
<span><span class="co">#&gt;    outcome          1</span></span>
<span><span class="co">#&gt;  predictor          4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Training data contained 10 data points and no missing data.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Operations:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adstock Transformation with retention 0.5 ontv [trained]</span></span>
<span><span class="co">#&gt; Adstock Transformation with retention 0.5 onsearch [trained]</span></span>
<span></span>
<span><span class="co">#see the final transformed output</span></span>
<span><span class="fu"><a href="https://recipes.tidymodels.org/reference/bake.html" class="external-link">bake</a></span><span class="op">(</span><span class="va">rec_obj</span>,<span class="va">mktdata</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 x 5</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   prod, store [2]</span></span></span>
<span><span class="co">#&gt;    prod  store     tv search sales</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> brand store1  10     0      100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> brand store1 105    10      100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> brand store1  52.5  25      100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> brand store1  26.2  62.5    100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> brand store1 113.   81.2    100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> brand store2   0     0       10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> brand store2   0     2       10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> brand store2   0     3       10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> brand store2   0     1.5     10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> brand store2   0     0.75    10</span></span>
<span></span>
<span><span class="co">#note what happens to store = 'all' in mktdata2:</span></span>
<span><span class="fu"><a href="https://recipes.tidymodels.org/reference/bake.html" class="external-link">bake</a></span><span class="op">(</span><span class="va">rec_obj</span>,<span class="va">mktdata2</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 x 5</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   prod, store [1]</span></span></span>
<span><span class="co">#&gt;   prod  store    tv search sales</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> brand <span style="color: #BB0000;">NA</span>     <span style="text-decoration: underline;">1</span>000   <span style="text-decoration: underline;">1</span>000   100</span></span>
<span></span>
<span><span class="co">#check to make sure that per-variable application of the step_adstock and step-saturation do not break the grouping structure even though</span></span>
<span><span class="co">#the output tibble from bake is ungrouped (irritatingly)</span></span>
<span></span>
<span><span class="va">rec_both_steps</span><span class="op">&lt;-</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">sales</span><span class="op">~</span><span class="va">.</span>,data<span class="op">=</span><span class="va">mktdata</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/step_adstock.html">step_adstock</a></span><span class="op">(</span><span class="va">tv</span>,retention<span class="op">=</span><span class="fl">.1</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/step_saturation.html">step_saturation</a></span><span class="op">(</span><span class="va">tv</span>,asymptote<span class="op">=</span><span class="fl">1000</span>,saturation_speed<span class="op">=</span><span class="fl">.001</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/step_adstock.html">step_adstock</a></span><span class="op">(</span><span class="va">search</span>,retention<span class="op">=</span><span class="fl">.1</span><span class="op">)</span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html" class="external-link">prep</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://recipes.tidymodels.org/reference/bake.html" class="external-link">bake</a></span><span class="op">(</span><span class="va">rec_both_steps</span>,<span class="va">mktdata</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 x 5</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   prod, store [2]</span></span></span>
<span><span class="co">#&gt;    prod  store     tv search sales</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> brand store1  9.95  0       100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> brand store1 96.1  10       100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> brand store1 10.0  21       100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> brand store1  1.01 52.1     100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> brand store1 95.3  55.2     100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> brand store2  0     0        10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> brand store2  0     2        10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> brand store2  0     2.2      10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> brand store2  0     0.22     10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> brand store2  0     0.022    10</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="handling-roles-and-steps-in-bulk">handling roles and steps in bulk<a class="anchor" aria-label="anchor" href="#handling-roles-and-steps-in-bulk"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mostlytidyMMM</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/recipes" class="external-link">recipes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dials.tidymodels.org" class="external-link">dials</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tune.tidymodels.org/" class="external-link">tune</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#get control spreadsheet</span></span>
<span><span class="va">control_file</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'example model control.xlsx'</span>,package<span class="op">=</span><span class="st">'mostlytidyMMM'</span><span class="op">)</span></span>
<span><span class="va">var_controls</span><span class="op">&lt;-</span><span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="va">control_file</span>,<span class="st">'variables'</span><span class="op">)</span></span>
<span><span class="va">transform_controls</span><span class="op">&lt;-</span><span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="va">control_file</span>,<span class="st">'role controls'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_set</span><span class="op">=</span><span class="fu"><a href="../reference/rename_columns_per_controls.html">rename_columns_per_controls</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"example2.csv"</span>, package <span class="op">=</span> <span class="st">"mostlytidyMMM"</span><span class="op">)</span><span class="op">)</span>,variable_controls<span class="op">=</span><span class="va">var_controls</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">recipe0</span><span class="op">&lt;-</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_set</span>,n<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">recipe1</span><span class="op">&lt;-</span><span class="va">recipe0</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/bulk_update_role.html">bulk_update_role</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/bulk_add_role.html">bulk_add_role</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/add_steps_media.html">add_steps_media</a></span><span class="op">(</span><span class="va">recipe1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Recipe</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Inputs:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          role #variables</span></span>
<span><span class="co">#&gt;         group          2</span></span>
<span><span class="co">#&gt;       outcome          1</span></span>
<span><span class="co">#&gt;   postprocess          3</span></span>
<span><span class="co">#&gt;     predictor          7</span></span>
<span><span class="co">#&gt;         price          1</span></span>
<span><span class="co">#&gt;  programmatic          2</span></span>
<span><span class="co">#&gt;          time          1</span></span>
<span><span class="co">#&gt;       time_id          1</span></span>
<span><span class="co">#&gt;         trend          1</span></span>
<span><span class="co">#&gt;            tv          4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Operations:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adstock Transformation with retention tune on Adstock Transformation with retention programmatic_retention onhas_role("programmatic")</span></span>
<span><span class="co">#&gt; Saturation (asymptote= tune saturation_speed= tune Transformation on Saturation (asymptote= programmatic_asymptote saturation_speed= programmatic_saturation_speed Transformation onhas_role("programmatic")</span></span>
<span><span class="co">#&gt; Adstock Transformation with retention tune on Adstock Transformation with retention tv_retention onhas_role("tv")</span></span>
<span><span class="co">#&gt; Saturation (asymptote= tune saturation_speed= tune Transformation on Saturation (asymptote= tv_asymptote saturation_speed= tv_saturation_speed Transformation onhas_role("tv")</span></span>
<span></span>
<span><span class="va">recipe1</span></span>
<span><span class="co">#&gt; Recipe</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Inputs:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          role #variables</span></span>
<span><span class="co">#&gt;         group          2</span></span>
<span><span class="co">#&gt;       outcome          1</span></span>
<span><span class="co">#&gt;   postprocess          3</span></span>
<span><span class="co">#&gt;     predictor          7</span></span>
<span><span class="co">#&gt;         price          1</span></span>
<span><span class="co">#&gt;  programmatic          2</span></span>
<span><span class="co">#&gt;          time          1</span></span>
<span><span class="co">#&gt;       time_id          1</span></span>
<span><span class="co">#&gt;         trend          1</span></span>
<span><span class="co">#&gt;            tv          4</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-rethinkingulam-inputs">Creating rethinking::ulam inputs<a class="anchor" aria-label="anchor" href="#creating-rethinkingulam-inputs"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/recipes" class="external-link">recipes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tune.tidymodels.org/" class="external-link">tune</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dials.tidymodels.org" class="external-link">dials</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mostlytidyMMM</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#get the control file:</span></span>
<span><span class="va">control_file</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'example model control.xlsx'</span>,package<span class="op">=</span><span class="st">'mostlytidyMMM'</span><span class="op">)</span></span>
<span><span class="co">#get each relevant table of the control file:</span></span>
<span><span class="va">var_controls</span><span class="op">&lt;-</span><span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="va">control_file</span>,<span class="st">'variables'</span><span class="op">)</span></span>
<span><span class="va">transform_controls</span><span class="op">&lt;-</span><span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="va">control_file</span>,<span class="st">'role controls'</span><span class="op">)</span></span>
<span><span class="va">workflow_controls</span><span class="op">&lt;-</span><span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="va">control_file</span>,<span class="st">"workflow"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">desc</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#pull data, add fourier transform columns</span></span>
<span><span class="va">data1</span><span class="op">=</span><span class="fu"><a href="../reference/rename_columns_per_controls.html">rename_columns_per_controls</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"example2.csv"</span>, package <span class="op">=</span> <span class="st">"mostlytidyMMM"</span><span class="op">)</span><span class="op">)</span>,variable_controls<span class="op">=</span><span class="va">var_controls</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>week<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">week</span>,<span class="st">"%m/%d/%Y"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">product</span><span class="op">)</span>,<span class="va">as.factor</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">product</span>,<span class="va">store</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">product</span>,<span class="va">store</span>,<span class="va">week</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>day_int<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,</span>
<span>         cos1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">day_int</span><span class="op">/</span><span class="fl">356</span><span class="op">)</span>,</span>
<span>         cos2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="fl">4</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">day_int</span><span class="op">/</span><span class="fl">356</span><span class="op">)</span>,</span>
<span>         cos3 <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="fl">6</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">day_int</span><span class="op">/</span><span class="fl">356</span><span class="op">)</span>,</span>
<span>         cos4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="fl">8</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">day_int</span><span class="op">/</span><span class="fl">356</span><span class="op">)</span>,</span>
<span>         cos5 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="fl">10</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">day_int</span><span class="op">/</span><span class="fl">356</span><span class="op">)</span>,</span>
<span>         sin1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">day_int</span><span class="op">/</span><span class="fl">356</span><span class="op">)</span>,</span>
<span>         sin2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">4</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">day_int</span><span class="op">/</span><span class="fl">356</span><span class="op">)</span>,</span>
<span>         sin3<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">6</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">day_int</span><span class="op">/</span><span class="fl">356</span><span class="op">)</span>,</span>
<span>         sin4<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">8</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">day_int</span><span class="op">/</span><span class="fl">356</span><span class="op">)</span>,</span>
<span>         sin5<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">10</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">day_int</span><span class="op">/</span><span class="fl">356</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">day_int</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>store<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">store</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#append several more columns</span></span>
<span><span class="va">lotsa_vars</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'x'</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">60</span><span class="op">)</span></span>
<span><span class="va">new_x</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">60</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">new_x</span><span class="op">)</span><span class="op">&lt;-</span><span class="va">lotsa_vars</span></span>
<span><span class="va">new_x</span><span class="op">&lt;-</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">new_x</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if</span></span>
<span><span class="co">#&gt; `.name_repair` is omitted as of tibble 2.0.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">i</span> Using compatibility `.name_repair`.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span><span class="co">#bring the data together:</span></span>
<span><span class="va">data_for_lotsa_vars</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">data1</span> ,<span class="va">new_x</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#make recipes</span></span>
<span><span class="va">recipea</span><span class="op">&lt;-</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_for_lotsa_vars</span>,n<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">recipeb</span><span class="op">&lt;-</span><span class="va">recipea</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/bulk_update_role.html">bulk_update_role</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/bulk_add_role.html">bulk_add_role</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">recipeb</span><span class="op">&lt;-</span><span class="va">recipeb</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/add_steps_media.html">add_steps_media</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_select.html" class="external-link">step_select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">has_role</a></span><span class="op">(</span><span class="st">'postprocess'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">recipec</span> <span class="op">&lt;-</span><span class="va">recipeb</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_mutate.html" class="external-link">step_mutate</a></span><span class="op">(</span>week<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span><span class="op">-</span><span class="fl">19247.65</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/roles.html" class="external-link">update_role</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sin1</span>,<span class="va">sin2</span>,<span class="va">sin3</span>,<span class="va">cos1</span>,<span class="va">cos2</span>,<span class="va">cos3</span><span class="op">)</span>,new_role<span class="op">=</span><span class="st">'time'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/roles.html" class="external-link">add_role</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sin1</span>,<span class="va">sin2</span>,<span class="va">sin3</span>,<span class="va">cos1</span>,<span class="va">cos2</span>,<span class="va">cos3</span><span class="op">)</span>,new_role<span class="op">=</span><span class="st">'predictor'</span><span class="op">)</span></span>
<span><span class="va">recipec</span><span class="op">&lt;-</span><span class="va">recipec</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/roles.html" class="external-link">update_role</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">'x'</span><span class="op">)</span>,new_role<span class="op">=</span><span class="st">'predictor'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: No columns were selected in `update_role()`.</span></span>
<span></span>
<span><span class="co"># build a model formula in the lmer style from the recipe:</span></span>
<span><span class="op">(</span><span class="va">formula_with_lotsa_vars</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/create_formula.html">create_formula</a></span><span class="op">(</span><span class="va">recipec</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "sales ~ price + TV1 + TV2 + ProgVideo1 + trend + (1|store) + (TV1|store) + (TV2|store)"</span></span>
<span></span>
<span><span class="co">#build a list suitable for input to rethinking::ulam from the formula and recipe:</span></span>
<span><span class="op">(</span><span class="fu"><a href="../reference/create_ulam_list.html">create_ulam_list</a></span><span class="op">(</span>model_formula<span class="op">=</span><span class="va">formula_with_lotsa_vars</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; sales ~ normal(big_model, big_sigma)</span></span>
<span><span class="co">#&gt; &lt;environment: 0x0000000026d67f08&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; big_model &lt;- big_model_1 + a0 + store_int[store_id] + b_TV1_interact_store[store_id] + </span></span>
<span><span class="co">#&gt;     b_TV2_interact_store[store_id]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; big_model_1 &lt;- b_price * price + b_TV1 * TV1 + b_TV2 * TV2 + </span></span>
<span><span class="co">#&gt;     b_ProgVideo1 * ProgVideo1 + b_trend * trend</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $b_TV1_interact_store</span></span>
<span><span class="co">#&gt; b_TV1_interact_store[store_id] ~ normal(0, slope_sigma)</span></span>
<span><span class="co">#&gt; &lt;environment: 0x00000000264a0d90&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $b_TV2_interact_store</span></span>
<span><span class="co">#&gt; b_TV2_interact_store[store_id] ~ normal(0, slope_sigma)</span></span>
<span><span class="co">#&gt; &lt;environment: 0x00000000264a0d90&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $store</span></span>
<span><span class="co">#&gt; store_int[store_id] ~ normal(65, int_sigma)</span></span>
<span><span class="co">#&gt; &lt;environment: 0x00000000264abf20&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $b_trend</span></span>
<span><span class="co">#&gt; b_trend ~ normal(0, 10)</span></span>
<span><span class="co">#&gt; &lt;environment: 0x000000002649aa10&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $b_price</span></span>
<span><span class="co">#&gt; b_price ~ normal(-1, 10)</span></span>
<span><span class="co">#&gt; &lt;environment: 0x0000000026610208&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $b_TV1</span></span>
<span><span class="co">#&gt; b_TV1 ~ normal(1, 10)</span></span>
<span><span class="co">#&gt; &lt;environment: 0x0000000026609f20&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $b_TV2</span></span>
<span><span class="co">#&gt; b_TV2 ~ normal(1, 10)</span></span>
<span><span class="co">#&gt; &lt;environment: 0x0000000026604978&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $b_ProgVideo1</span></span>
<span><span class="co">#&gt; b_ProgVideo1 ~ normal(1, 10)</span></span>
<span><span class="co">#&gt; &lt;environment: 0x0000000026602e48&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[12]]</span></span>
<span><span class="co">#&gt; a0 ~ normal(50, 50)</span></span>
<span><span class="co">#&gt; &lt;environment: 0x0000000026d67f08&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[13]]</span></span>
<span><span class="co">#&gt; big_sigma ~ half_cauchy(0, 100)</span></span>
<span><span class="co">#&gt; &lt;environment: 0x0000000026d67f08&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[14]]</span></span>
<span><span class="co">#&gt; int_sigma ~ half_cauchy(0, 10)</span></span>
<span><span class="co">#&gt; &lt;environment: 0x0000000026d67f08&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[15]]</span></span>
<span><span class="co">#&gt; slope_sigma ~ half_cauchy(0, 10)</span></span>
<span><span class="co">#&gt; &lt;environment: 0x0000000026d67f08&gt;</span></span></code></pre></div>
<!--

# There can be development actions

Create a chunk with 'development' actions

- The chunk needs to be named `development` or `dev`
- It contains functions that are used for package development only
- Note that you may want to store most of these functions in the 0-dev_history.Rmd file

These are only included in the present flat template file, their content will not be part of the package anywhere else.
-->
</div>
<div class="section level2">
<h2 id="inflate-your-package">Inflate your package<a class="anchor" aria-label="anchor" href="#inflate-your-package"></a>
</h2>
<p>Youâ€™re one inflate from paper to box. Build your package from this
very Rmd using <code><a href="https://thinkr-open.github.io/fusen/reference/inflate.html" class="external-link">fusen::inflate()</a></code></p>
<ul>
<li>Verify your <code>"DESCRIPTION"</code> file has been updated</li>
<li>Verify your function is in <code>"R/"</code> directory</li>
<li>Verify your test is in <code>"tests/testthat/"</code> directory</li>
<li>Verify this Rmd appears in <code>"vignettes/"</code> directory</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Lorenzen Ted.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
