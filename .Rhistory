n_campaigns=max(1,rpois(1,mean_campaigns_per_channel))
n_campaigns
#get actual number of campaigns
n_campaigns=max(1,rpois(1,mean_campaigns_per_channel))
n_campaigns
rbinom(1,157,.5)
rbinom(1,157,.5)
rbinom(1,157,.5)
rbinom(1,157,.5)
rbinom(1,157,.5)
rbinom(1,157,.5)
rbinom(1,157,.33)
rbinom(1,157,.33)
rbinom(1,157,.33)
rbinom(1,157,.33)
start<-runif(1,1,length(weeks))
start
sample(1:length(weeks))
?Sample
?sample
sample(1:length(weeks),1)
sample(1:length(weeks),1)
sample(1:length(weeks),1)
sample(1:length(weeks),1,replace=T)
sample(1:length(weeks),1,replace=T)
sample(1:length(weeks),1,replace=T)
start<-sample(1:length(weeks),1,replace=T)
start
tibble(list(a=c(1,1),b=c(2,2)))
tidyr::tibble(list(a=c(1,1),b=c(2,2)))
list(a=c(1,1),b=c(2,2)) |> map_df(enframe)
?map_df
list(a=c(1,1),b=c(2,2)) |> purrr::map_df(enframe)
??enframe
list(a=c(1,1),b=c(2,2)) |> purrr::map_df(tibble::enframe)
hold_my_data<-tibble::tibble(weeks=weeks)
campaign_name=paste0('campaign_',j,'_in_',channel_name)
n=1
j=1
campaign_name=paste0('campaign_',j,'_in_',channel_name)
this_duration<-rbinom(1,length(weeks),avg_fraction_of_weeks_campaign_lasts)
start<-sample(1:length(weeks),1,replace=T)
zeros
activity_binary<-vector('numeric',length(weeks))
activity_binary<-0
activity_binary
hold_my_data<-tibble::tibble(weeks=as.Date("1900-01-01"),channel_name="",campaign_name="",activity_binary=NaN,activity=NaN)
n_weeks=length(weeks)
hold_my_data<-tibble::tibble(weeks=as.Date("1900-01-01"),channel_name="",campaign_name="",activity_binary=NaN,activity=NaN)
campaign_name=paste0('campaign_',j,'_in_',channel_name)
this_duration<-rbinom(1,n_weeks,avg_fraction_of_weeks_campaign_lasts)
avg_fraction_of_weeks_campaign_lasts=.33
this_duration<-rbinom(1,n_weeks,avg_fraction_of_weeks_campaign_lasts)
start<-sample(1:n_weeks,1,replace=T)
activity_binary<-rep(0,n_weeks)
activity_binary[start:max(start+this_duration,n_weeks)]<-1
plot(activity_binary)
??truncnorm
??rnormTrunc
install.packages("EnvStats")
devtools::install_local("C:\\Users\\loren\\Documents\\R\\mostlytidyMMM",force=T)
devtools::install_local("C:\\Users\\loren\\Documents\\R\\mostlytidyMMM",force=T)
devtools::install_local("C:\\Users\\loren\\Documents\\R\\mostlytidyMMM",force=T)
devtools::install_local("C:\\Users\\loren\\Documents\\R\\mostlytidyMMM",force=T)
make_calendar<-function(weeks=wks,
n_channels=8,
mean_campaigns_per_channel=3,
avg_fraction_of_weeks_campaign_lasts=.33){
n_weeks=length(weeks)
hold_my_data<-tibble::tibble(weeks=as.Date("1900-01-01"),channel_name="",campaign_name="",activity_binary=NaN,activity=NaN)
for(i in 1:n_channels){
channel_name=paste0("channel_",i)
#get actual number of campaigns
n_campaigns=max(1,rpois(1,mean_campaigns_per_channel))
for(j in 1: n_campaigns){
campaign_name=paste0('campaign_',j,'_in_',channel_name)
this_duration<-rbinom(1,n_weeks,avg_fraction_of_weeks_campaign_lasts)
start<-sample(1:n_weeks,1,replace=T)
activity_binary<-rep(0,n_weeks)
activity_binary[start:max(start+this_duration,n_weeks)]<-1
activity=activity_binary*rnorm(n_weeks)
}
}
}
make_calendar()
wks<-seq(as.Date('2023-01-02'),as.Date('2025-12-29'),by=7)
set.seed(2718282)
make_calendar<-function(weeks=wks,
n_channels=8,
mean_campaigns_per_channel=3,
avg_fraction_of_weeks_campaign_lasts=.33){
n_weeks=length(weeks)
hold_my_data<-tibble::tibble(weeks=as.Date("1900-01-01"),channel_name="",campaign_name="",activity_binary=NaN,activity=NaN)
for(i in 1:n_channels){
channel_name=paste0("channel_",i)
#get actual number of campaigns
n_campaigns=max(1,rpois(1,mean_campaigns_per_channel))
for(j in 1: n_campaigns){
campaign_name=paste0('campaign_',j,'_in_',channel_name)
this_duration<-rbinom(1,n_weeks,avg_fraction_of_weeks_campaign_lasts)
start<-sample(1:n_weeks,1,replace=T)
activity_binary<-rep(0,n_weeks)
activity_binary[start:max(start+this_duration,n_weeks)]<-1
activity=activity_binary*rnorm(n_weeks)
}
}
}
make_calendar()
weeks=wks
n_channels=8
mean_campaigns_per_channel=3
avg_fraction_of_weeks_campaign_lasts=.33
n_weeks=length(weeks)
hold_my_data<-tibble::tibble(weeks=as.Date("1900-01-01"),channel_name="",campaign_name="",activity_binary=NaN,activity=NaN)
i=2
channel_name=paste0("channel_",i)
#get actual number of campaigns
n_campaigns=max(1,rpois(1,mean_campaigns_per_channel))
n_campaigns
j=1
campaign_name=paste0('campaign_',j,'_in_',channel_name)
this_duration<-rbinom(1,n_weeks,avg_fraction_of_weeks_campaign_lasts)
start<-sample(1:n_weeks,1,replace=T)
activity_binary<-rep(0,n_weeks)
activity_binary[start:max(start+this_duration,n_weeks)]<-1
activity=activity_binary*rnorm(n_weeks)
activity
nrow(running_frame)
length(running_frame)
running_frame=tibble()
running_frame=data.frame()
nrow(running_frame)
make_calendar<-function(weeks=wks,
n_channels=8,
mean_campaigns_per_channel=3,
avg_fraction_of_weeks_campaign_lasts=.33){
running_frame=data.frame()
n_weeks=length(weeks)
hold_my_data<-tibble::tibble(weeks=as.Date("1900-01-01"),channel_name="",campaign_name="",activity_binary=NaN,activity=NaN)
for(i in 1:n_channels){
channel_name=paste0("channel_",i)
#get actual number of campaigns
n_campaigns=max(1,rpois(1,mean_campaigns_per_channel))
for(j in 1: n_campaigns){
campaign_name=paste0('campaign_',j,'_in_',channel_name)
this_duration<-rbinom(1,n_weeks,avg_fraction_of_weeks_campaign_lasts)
start<-sample(1:n_weeks,1,replace=T)
activity_binary<-rep(0,n_weeks)
activity_binary[start:max(start+this_duration,n_weeks)]<-1
activity=activity_binary*rnorm(n_weeks)
this_frame<-tibble(leaf_level_campaign=campaign_name,channel=channel_name,
week=wks,activity=activity)
if(nrow(running_frame)==0){
running_frame=this_frame
}else{
running_frame<-rbind(running_frame,this_frame)
}
}
}
}
make_calendar()
make_calendar<-function(weeks=wks,
n_channels=8,
mean_campaigns_per_channel=3,
avg_fraction_of_weeks_campaign_lasts=.33){
running_frame=data.frame()
n_weeks=length(weeks)
hold_my_data<-tibble::tibble(weeks=as.Date("1900-01-01"),channel_name="",campaign_name="",activity_binary=NaN,activity=NaN)
for(i in 1:n_channels){
channel_name=paste0("channel_",i)
#get actual number of campaigns
n_campaigns=max(1,rpois(1,mean_campaigns_per_channel))
for(j in 1: n_campaigns){
campaign_name=paste0('campaign_',j,'_in_',channel_name)
this_duration<-rbinom(1,n_weeks,avg_fraction_of_weeks_campaign_lasts)
start<-sample(1:n_weeks,1,replace=T)
activity_binary<-rep(0,n_weeks)
activity_binary[start:max(start+this_duration,n_weeks)]<-1
activity=activity_binary*rnorm(n_weeks)
this_frame<-data.frame(leaf_level_campaign=campaign_name,channel=channel_name,
week=wks,activity=activity)
if(nrow(running_frame)==0){
running_frame=this_frame
}else{
running_frame<-rbind(running_frame,this_frame)
}
}
}
}
make_calendar()
make_calendar<-function(weeks=wks,
n_channels=8,
mean_campaigns_per_channel=3,
avg_fraction_of_weeks_campaign_lasts=.33){
running_frame=data.frame()
n_weeks=length(weeks)
hold_my_data<-tibble::tibble(weeks=as.Date("1900-01-01"),channel_name="",campaign_name="",activity_binary=NaN,activity=NaN)
for(i in 1:n_channels){
channel_name=paste0("channel_",i)
#get actual number of campaigns
n_campaigns=max(1,rpois(1,mean_campaigns_per_channel))
for(j in 1: n_campaigns){
campaign_name=paste0('campaign_',j,'_in_',channel_name)
this_duration<-rbinom(1,n_weeks,avg_fraction_of_weeks_campaign_lasts)
start<-sample(1:n_weeks,1,replace=T)
activity_binary<-rep(0,n_weeks)
activity_binary[start:max(start+this_duration,n_weeks)]<-1
activity=activity_binary*rnorm(n_weeks)
length(campaign_name)
length(channel_name)
length(wks)
length(activity)
this_frame<-data.frame(leaf_level_campaign=campaign_name,channel=channel_name,
week=wks,activity=activity)
if(nrow(running_frame)==0){
running_frame=this_frame
}else{
running_frame<-rbind(running_frame,this_frame)
}
}
}
}
make_calendar()
make_calendar<-function(weeks=wks,
n_channels=8,
mean_campaigns_per_channel=3,
avg_fraction_of_weeks_campaign_lasts=.33){
running_frame=data.frame()
n_weeks=length(weeks)
hold_my_data<-tibble::tibble(weeks=as.Date("1900-01-01"),channel_name="",campaign_name="",activity_binary=NaN,activity=NaN)
for(i in 1:n_channels){
channel_name=paste0("channel_",i)
#get actual number of campaigns
n_campaigns=max(1,rpois(1,mean_campaigns_per_channel))
for(j in 1: n_campaigns){
campaign_name=paste0('campaign_',j,'_in_',channel_name)
this_duration<-rbinom(1,n_weeks,avg_fraction_of_weeks_campaign_lasts)
start<-sample(1:n_weeks,1,replace=T)
activity_binary<-rep(0,n_weeks)
activity_binary[start:max(start+this_duration,n_weeks)]<-1
activity=activity_binary*rnorm(n_weeks)
print(length(campaign_name))
print(length(channel_name))
print(length(weeks))
print(length(activity))
this_frame<-data.frame(leaf_level_campaign=campaign_name,channel=channel_name,
week=wks,activity=activity)
if(nrow(running_frame)==0){
running_frame=this_frame
}else{
running_frame<-rbind(running_frame,this_frame)
}
}
}
}
make_calendar()
make_calendar<-function(weeks=wks,
n_channels=8,
mean_campaigns_per_channel=3,
avg_fraction_of_weeks_campaign_lasts=.33){
running_frame=data.frame()
n_weeks=length(weeks)
print(paste0('n_weeks:',n_weeks))
hold_my_data<-tibble::tibble(weeks=as.Date("1900-01-01"),channel_name="",campaign_name="",activity_binary=NaN,activity=NaN)
for(i in 1:n_channels){
channel_name=paste0("channel_",i)
#get actual number of campaigns
n_campaigns=max(1,rpois(1,mean_campaigns_per_channel))
for(j in 1: n_campaigns){
campaign_name=paste0('campaign_',j,'_in_',channel_name)
this_duration<-rbinom(1,n_weeks,avg_fraction_of_weeks_campaign_lasts)
start<-sample(1:n_weeks,1,replace=T)
activity_binary<-rep(0,n_weeks)
activity_binary[start:max(start+this_duration,n_weeks)]<-1
activity=activity_binary*rnorm(n_weeks)
print(length(campaign_name))
print(length(channel_name))
print(length(weeks))
print(length(activity))
this_frame<-data.frame(leaf_level_campaign=campaign_name,channel=channel_name,
week=wks,activity=activity)
if(nrow(running_frame)==0){
running_frame=this_frame
}else{
running_frame<-rbind(running_frame,this_frame)
}
}
}
}
make_calendar()
make_calendar<-function(weeks=wks,
n_channels=8,
mean_campaigns_per_channel=3,
avg_fraction_of_weeks_campaign_lasts=.33){
running_frame=data.frame()
n_weeks=length(weeks)
print(paste0('n_weeks:',n_weeks))
hold_my_data<-tibble::tibble(weeks=as.Date("1900-01-01"),channel_name="",campaign_name="",activity_binary=NaN,activity=NaN)
for(i in 1:n_channels){
channel_name=paste0("channel_",i)
#get actual number of campaigns
n_campaigns=max(1,rpois(1,mean_campaigns_per_channel))
for(j in 1: n_campaigns){
campaign_name=paste0('campaign_',j,'_in_',channel_name)
this_duration<-rbinom(1,n_weeks,avg_fraction_of_weeks_campaign_lasts)
start<-sample(1:n_weeks,1,replace=T)
activity_binary<-rep(0,n_weeks)
activity_binary[start:max(start+this_duration,n_weeks)]<-1
activity=activity_binary*rnorm(n_weeks)
print(length(campaign_name))
print(length(channel_name))
print(length(weeks))
print(length(activity_binary))
print(length(activity))
this_frame<-data.frame(leaf_level_campaign=campaign_name,channel=channel_name,
week=wks,activity=activity)
if(nrow(running_frame)==0){
running_frame=this_frame
}else{
running_frame<-rbind(running_frame,this_frame)
}
}
}
}
make_calendar()
make_calendar<-function(weeks=wks,
n_channels=8,
mean_campaigns_per_channel=3,
avg_fraction_of_weeks_campaign_lasts=.33){
running_frame=data.frame()
n_weeks=length(weeks)
print(paste0('n_weeks:',n_weeks))
hold_my_data<-tibble::tibble(weeks=as.Date("1900-01-01"),channel_name="",campaign_name="",activity_binary=NaN,activity=NaN)
for(i in 1:n_channels){
channel_name=paste0("channel_",i)
#get actual number of campaigns
n_campaigns=max(1,rpois(1,mean_campaigns_per_channel))
for(j in 1: n_campaigns){
print('this n_weeks:',n_weeks)
campaign_name=paste0('campaign_',j,'_in_',channel_name)
this_duration<-rbinom(1,n_weeks,avg_fraction_of_weeks_campaign_lasts)
start<-sample(1:n_weeks,1,replace=T)
activity_binary<-rep(0,n_weeks)
activity_binary[start:max(start+this_duration,n_weeks)]<-1
activity=activity_binary*rnorm(n_weeks)
print(length(campaign_name))
print(length(channel_name))
print(length(weeks))
print(length(activity_binary))
print(length(activity))
this_frame<-data.frame(leaf_level_campaign=campaign_name,channel=channel_name,
week=wks,activity=activity)
if(nrow(running_frame)==0){
running_frame=this_frame
}else{
running_frame<-rbind(running_frame,this_frame)
}
}
}
}
make_calendar()
make_calendar<-function(weeks=wks,
n_channels=8,
mean_campaigns_per_channel=3,
avg_fraction_of_weeks_campaign_lasts=.33){
running_frame=data.frame()
n_weeks=length(weeks)
print(paste0('n_weeks:',n_weeks))
hold_my_data<-tibble::tibble(weeks=as.Date("1900-01-01"),channel_name="",campaign_name="",activity_binary=NaN,activity=NaN)
for(i in 1:n_channels){
channel_name=paste0("channel_",i)
#get actual number of campaigns
n_campaigns=max(1,rpois(1,mean_campaigns_per_channel))
for(j in 1: n_campaigns){
print(paste0('this n_weeks:',n_weeks))
campaign_name=paste0('campaign_',j,'_in_',channel_name)
this_duration<-rbinom(1,n_weeks,avg_fraction_of_weeks_campaign_lasts)
start<-sample(1:n_weeks,1,replace=T)
activity_binary<-rep(0,n_weeks)
activity_binary[start:max(start+this_duration,n_weeks)]<-1
activity=activity_binary*rnorm(n_weeks)
print(length(campaign_name))
print(length(channel_name))
print(length(weeks))
print(length(activity_binary))
print(length(activity))
this_frame<-data.frame(leaf_level_campaign=campaign_name,channel=channel_name,
week=wks,activity=activity)
if(nrow(running_frame)==0){
running_frame=this_frame
}else{
running_frame<-rbind(running_frame,this_frame)
}
}
}
}
make_calendar()
make_calendar<-function(weeks=wks,
n_channels=8,
mean_campaigns_per_channel=3,
avg_fraction_of_weeks_campaign_lasts=.33){
running_frame=data.frame()
n_weeks=length(weeks)
print(paste0('n_weeks:',n_weeks))
hold_my_data<-tibble::tibble(weeks=as.Date("1900-01-01"),channel_name="",campaign_name="",activity_binary=NaN,activity=NaN)
for(i in 1:n_channels){
channel_name=paste0("channel_",i)
#get actual number of campaigns
n_campaigns=max(1,rpois(1,mean_campaigns_per_channel))
for(j in 1: n_campaigns){
print(paste0('this n_weeks:',n_weeks))
campaign_name=paste0('campaign_',j,'_in_',channel_name)
this_duration<-rbinom(1,n_weeks,avg_fraction_of_weeks_campaign_lasts)
start<-sample(1:n_weeks,1,replace=T)
activity_binary<-rep(0,n_weeks)
activity_binary[start:min(start+this_duration,n_weeks)]<-1
activity=activity_binary*rnorm(n_weeks)
print(length(campaign_name))
print(length(channel_name))
print(length(weeks))
print(length(activity_binary))
print(length(activity))
this_frame<-data.frame(leaf_level_campaign=campaign_name,channel=channel_name,
week=wks,activity=activity)
if(nrow(running_frame)==0){
running_frame=this_frame
}else{
running_frame<-rbind(running_frame,this_frame)
}
}
}
}
make_calendar()
make_calendar<-function(weeks=wks,
n_channels=8,
mean_campaigns_per_channel=3,
avg_fraction_of_weeks_campaign_lasts=.33){
running_frame=data.frame()
n_weeks=length(weeks)
# print(paste0('n_weeks:',n_weeks))
hold_my_data<-tibble::tibble(weeks=as.Date("1900-01-01"),channel_name="",campaign_name="",activity_binary=NaN,activity=NaN)
for(i in 1:n_channels){
channel_name=paste0("channel_",i)
#get actual number of campaigns
n_campaigns=max(1,rpois(1,mean_campaigns_per_channel))
for(j in 1: n_campaigns){
#   print(paste0('this n_weeks:',n_weeks))
campaign_name=paste0('campaign_',j,'_in_',channel_name)
this_duration<-rbinom(1,n_weeks,avg_fraction_of_weeks_campaign_lasts)
start<-sample(1:n_weeks,1,replace=T)
activity_binary<-rep(0,n_weeks)
activity_binary[start:min(start+this_duration,n_weeks)]<-1
activity=activity_binary*rnorm(n_weeks)
this_frame<-data.frame(leaf_level_campaign=campaign_name,channel=channel_name,
week=wks,activity=activity)
if(nrow(running_frame)==0){
running_frame=this_frame
}else{
running_frame<-rbind(running_frame,this_frame)
}
}
}
}
make_calendar()
make_calendar<-function(weeks=wks,
n_channels=8,
mean_campaigns_per_channel=3,
avg_fraction_of_weeks_campaign_lasts=.33){
running_frame=data.frame()
n_weeks=length(weeks)
# print(paste0('n_weeks:',n_weeks))
hold_my_data<-tibble::tibble(weeks=as.Date("1900-01-01"),channel_name="",campaign_name="",activity_binary=NaN,activity=NaN)
for(i in 1:n_channels){
channel_name=paste0("channel_",i)
#get actual number of campaigns
n_campaigns=max(1,rpois(1,mean_campaigns_per_channel))
for(j in 1: n_campaigns){
#   print(paste0('this n_weeks:',n_weeks))
campaign_name=paste0('campaign_',j,'_in_',channel_name)
this_duration<-rbinom(1,n_weeks,avg_fraction_of_weeks_campaign_lasts)
start<-sample(1:n_weeks,1,replace=T)
activity_binary<-rep(0,n_weeks)
activity_binary[start:min(start+this_duration,n_weeks)]<-1
activity=activity_binary*rnorm(n_weeks)
this_frame<-data.frame(leaf_level_campaign=campaign_name,channel=channel_name,
week=wks,activity=activity)
if(nrow(running_frame)==0){
running_frame=this_frame
}else{
running_frame<-rbind(running_frame,this_frame)
}
}
}
return(running_frame)
}
make_calendar()
make_calendar() |> group_by(campaign) |> reframe(range(activity))
make_calendar() |> group_by(campaign) |>dplyr::reframe(range(activity))
make_calendar() |> dplyr::group_by(campaign) |>dplyr::reframe(range(activity))
make_calendar() |> dplyr::group_by(leaf_level_campaign) |>dplyr::reframe(range(activity))
make_calendar() |> dplyr::group_by(leaf_level_campaign) |>dplyr::summarise(min=min(activity),max=max(activity),
n_non_zero=sum(ifelse(activity!=0,1,0))) |>
tidyr::pivot_wider(cols=c(min,max,n_non_zero),id_cols=leaf_level_campaign)
make_calendar() |> dplyr::group_by(leaf_level_campaign) |>dplyr::summarise(min=min(activity),max=max(activity),
n_non_zero=sum(ifelse(activity!=0,1,0)))
setwd()
getwd()
setwd('C:\\Users\\loren\\Documents\\R\\mostlytidyMMM')
devtools::install_local(".",force=T)
# Keep eval=FALSE to avoid infinite loop in case you hit the knit button
# Execute in the console directly
fusen::inflate(flat_file = "dev/flat_full.Rmd", vignette_name = "Demonstration of Parts of the Package")
